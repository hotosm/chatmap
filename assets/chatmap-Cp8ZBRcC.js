var e=Object.defineProperty,s=(s,t,i)=>((s,t,i)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i)(s,"symbol"!=typeof t?t+"":t,i);class t{constructor(e,t,i){s(this,"locationMessages",{}),s(this,"pairedMessagesIds",{}),s(this,"getMessageFromSameUser",((e,s,t)=>{const i=this.messages,a=i[t],o=i[e];if((null==o?void 0:o.username)===s&&!this.pairedMessagesIds[o.id]){const s=Math.abs(a.time-o.time);if(o&&s<18e5&&(o.file||(null==o?void 0:o.message)))return{index:e,delta:s}}})),s(this,"getClosestMessage",((e,s)=>{var t,i;let a,o,n=s-1,r=s+1,l=e[s],d=!1,h=!1;const c=e.length+1;for(;(e[n]||e[r])&&(!o||!a);){if(!a&&!h){const e=this.getMessageFromSameUser(n,l.username,s);e&&(e.location?h=!0:a=e)}if(!o&&!d){const e=this.getMessageFromSameUser(r,l.username,s);e&&(e.location?d=!0:o=e)}n>-1&&!h&&n--,r<c&&!d&&r++}if((null==(t=e[null==a?void 0:a.index])?void 0:t.location)&&(a=null),(null==(i=e[null==o?void 0:o.index])?void 0:i.location)&&(o=null),a&&o){if(a.delta<=o.delta)return e[a.index];if(a.delta>=o.delta)return e[o.index]}else{if(a)return e[a.index];if(o)return e[o.index]}return l})),s(this,"getClosestMessageByDirection",((e,s,t)=>{let i,a=s+t,o=e[s];for(;e[a]&&!i;){if(e[a]&&e[a].username===o.username&&!i){i={index:a,delta:Math.abs(e[s].time-e[a].time)}}a+=t}return i?e[i.id]:o})),s(this,"pairContentAndLocations",(()=>{const e={type:"FeatureCollection",features:[]};return this.messages.forEach(((e,s)=>{e.id=s;const t=this.searchLocation(e);if(t){const s=[parseFloat(t[1]),parseFloat(t[0])];s[0]/Math.round(s[0])!=1&&s[1]/Math.round(s[1])!=0&&(e.location=[s[0],s[1]])}})),this.options.mediaOnly&&(this.messages=this.messages.filter((e=>e.file||e.location)),this.messages=this.messages.map(((e,s)=>({...e,id:s})))),this.messages.forEach((s=>{if(s.location){const t={type:"Feature",properties:{},geometry:{type:"Point",coordinates:s.location}},i=this.getClosestMessage(this.messages,s.id);this.pairedMessagesIds[i.id]=!0,this.options.mediaOnly&&!i.file||(t.properties={...i,message:i.location?"(Location only)":i.message},isNaN(t.properties.time)||e.features.push(t))}})),e})),this.messages=e,this.searchLocation=t,this.options=i,this.notMediaFileMessages={}}}export{t as C};

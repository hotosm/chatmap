import{g as t,a as e,b as o}from"./chatmap-CJOVdwUa.js";function a(t){return t.substring(t.lastIndexOf("/")+1,t.length)}const r=t=>new Date(t),i=t=>{let e=0;const o={};return t.forEach((t=>{const i=(t=>{let e="",o={time:r(t.date),username:t.from};return Array.isArray(t.text)?t.text.forEach((t=>{"link"===t.type&&(e=t.text)})):""!==t.text&&(e=t.text),o.message=e,t.location_information&&(o.location=[t.location_information.latitude,t.location_information.longitude]),t.photo&&(o.file=a(t.photo)),t.file&&"video/mp4"===t.mime_type&&(o.file=a(t.file)),o})(t);i&&(o[e]=i,e++)})),o};function n({text:a,msgPosition:r}){if(!a)return;const n=JSON.parse(a),s={type:"FeatureCollection",features:[]},l=i(n.messages);return Object.values(l).forEach(((a,i)=>{if(a.location){let n,c={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[a.location[1],a.location[0]]}};switch(r){case"before":n=o(l,i);break;case"after":n=e(l,i);break;default:n=t(l,i)}c.properties={...n},s.features.push(c)}})),s}export{n as default};

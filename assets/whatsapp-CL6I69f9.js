import{g as e,a as t,b as s}from"./chatmap-CJOVdwUa.js";const r=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?).*$/,a={IOS:/\[(.*)\] ([^:]*): (.*)/,ANDROID:/(.*) - ([^:]*): (.*)/},n=e=>{const t=e.match(a.IOS),s=e.match(a.ANDROID);return t?"IOS":s?"ANDROID":"UNKNOWN"},l=e=>{const t=e.message.toLowerCase();let s=t.indexOf(".jpg");if(s<0&&(s=t.indexOf(".mp4")),s>0){let r=e.message.substring(t.lastIndexOf(":")+1,s+4);return" "==r.substring(0,1)?r.substring(1,r.length):r}return""},o=e=>{const t=e.match(r);return t?t[0].split(",").map((e=>parseFloat(e))):null},i=(e,t)=>{const s=e.match(a[t]);if(s){let e=s[2];const t=e.indexOf(":");t>-1&&(e=e.substring(0,t));let r={time:c(s[1]),username:e,message:s[3]};return r.file=l(r),r.file&&(r.message=""),r}},c=e=>{let t=e.replace("a. m.","AM").replace("p. m.","PM");t=t.replace("a.m.","AM").replace("p.m.","PM");let s=t.split(" ");const r=new Date;let a=[[r.getFullYear(),r.getMonth()+1,r.getDate()].join("/"),s[1]].join(" ");return new Date(a)},u=(e,t)=>{let s=0;const r={};return e.forEach((e=>{e=e.replaceAll(/[\u200E\u200F\u202A-\u202E\u200B]/g,"");const a=i(e,t);a?(r[s]=a,s++):(r[s-1]&&"ANDROID"==t&&"/"!==e.substring(2,1)&&-1==e.indexOf("a. m.")&&-1==e.indexOf("p. m.")||"IOS"==t&&-1==e.indexOf("["))&&(r[s-1].message+=" "+e)})),r};function p({text:r,msgPosition:a}){if(!r)return;const l=r.split("\n"),i={type:"FeatureCollection",features:[]};let c,p={};for(let e=0;e<l.length&&(c=n(l[e]),"UNKNOWN"===c);e++);const m=u(l,c),f=Object.values(m);let g=0;return f.forEach(((r,n)=>{if(r.message){const l=o(r.message);if(l){let r;switch(p={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[parseFloat(l[1]),parseFloat(l[0])]}},a){case"before":r=s(m,n);break;case"after":r=t(m,n);break;default:r=e(m,n)}p.properties={...r},p.properties.id=g,g+=1,i.features.push(p)}}})),i}export{p as default,n as detectSystem,l as lookForMediaFile,u as parseAndIndex,i as parseMessage,c as parseTimeString,o as searchLocation};

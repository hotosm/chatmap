var e=Object.defineProperty,s=(s,t,i)=>((s,t,i)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i)(s,"symbol"!=typeof t?t+"":t,i);class t{constructor(e,t){s(this,"locationMessages",{}),s(this,"pairedMessagesIds",[]),s(this,"getMessageFromSameUser",((e,s,t)=>{var i,a;const r=this.messages;if((null==(i=r[e])?void 0:i.username)===s){const s=Math.abs(r[t].time-r[e].time);if(r[e]&&s<18e5&&(r[e].file||(null==(a=r[e])?void 0:a.message)))return{index:e,delta:s}}})),s(this,"getClosestMessage",((e,s)=>{let t,i,a=s-1,r=s+1,n=e[s],o=!1,d=!1;for(;(e[a]||e[r])&&(!i||!t);){if(!t&&!d){const e=this.getMessageFromSameUser(a,n.username,s);e&&(this.locationMessages[e.index]?d=!0:t=e)}if(!i&&!o){const e=this.getMessageFromSameUser(r,n.username,s);e&&(this.locationMessages[e.index]?o=!0:i=e)}a--,r++}if(t&&i){if(t.delta===i.delta)return-1===this.pairedMessagesIds.indexOf(t.index)?e[t.index]:e[i.index];if(t.delta<i.delta)return e[t.index];if(t.delta>i.delta)return e[i.index]}else{if(t)return e[t.index];if(i)return e[i.index]}return n})),s(this,"getClosestMessageByDirection",((e,s,t)=>{let i,a=s+t,r=e[s];for(;e[a]&&!i;){if(e[a]&&e[a].username===r.username&&!i){i={index:a,delta:Math.abs(e[s].time-e[a].time)}}a+=t}return i?e[i.index]:r})),s(this,"pairContentAndLocations",(()=>{const e=this.msgObjects,s=this.messages,t=this.searchLocation,i={type:"FeatureCollection",features:[]};let a={};return e.forEach(((e,s)=>{const i=t(e);if(i){const e=[parseFloat(i[1]),parseFloat(i[0])];e[0]/Math.round(e[0])!=1&&e[1]/Math.round(e[1])!=0&&(this.locationMessages[s]=[e[0],e[1]])}})),e.forEach(((e,t)=>{if(this.locationMessages[t]){a={type:"Feature",properties:{},geometry:{type:"Point",coordinates:this.locationMessages[t]}};const r=this.getClosestMessage(s,t);r?-1===this.pairedMessagesIds.indexOf(r.id)&&(a.properties={...r,related:r.id},this.pairedMessagesIds.push(r.id)):a.properties={username:e.username,time:e.time},a.properties.id=t,isNaN(a.properties.time)||i.features.push(a)}})),i})),this.messages=e,this.searchLocation=t,this.msgObjects=Object.values(e)}}export{t as C};

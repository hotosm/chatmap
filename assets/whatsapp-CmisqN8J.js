import{g as e}from"./chatmap-ChGbHgkD.js";const t=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?).*$/,s={IOS:/\[(.*)\] ([^:]*): (.*)/,ANDROID:/(.*) - ([^:]*): (.*)/},r=e=>{const t=e.match(s.IOS),r=e.match(s.ANDROID);return t?"IOS":r?"ANDROID":"UNKNOWN"},a=e=>{const t=e.message.toLowerCase();let s=t.indexOf(".jpg");if(s<0&&(s=t.indexOf(".mp4")),s>0){let r=e.message.substring(t.lastIndexOf(":")+1,s+4);return" "==r.substring(0,1)?r.substring(1,r.length):r}return""},n=e=>{const s=e.match(t);return s?s[0].split(",").map((e=>parseFloat(e))):null},o=(e,t)=>{const r=e.match(s[t]);if(r){let e=r[2];const t=e.indexOf(":");t>-1&&(e=e.substring(0,t));let s={time:i(r[1]),username:e,message:r[3]};return s.file=a(s),s.file&&(s.message=""),s}},i=e=>{let t=e.replace("a. m.","AM").replace("p. m.","PM");t=t.replace("a.m.","AM").replace("p.m.","PM");let s=t.split(" ");const r=new Date;let a=[[r.getFullYear(),r.getMonth()+1,r.getDate()].join("/"),s[1]].join(" ");return new Date(a)},p=(e,t)=>{let s=0;const r={};return e.forEach((e=>{e=e.replaceAll(/[\u200E\u200F\u202A-\u202E\u200B]/g,"");const a=o(e,t);a?(r[s]=a,r[s].id=s,s++):(r[s-1]&&"ANDROID"==t&&"/"!==e.substring(2,1)&&-1==e.indexOf("a. m.")&&-1==e.indexOf("p. m.")||"IOS"==t&&-1==e.indexOf("["))&&(r[s-1].message+=" "+e)})),r};function l({text:t}){if(!t)return;const s=t.split("\n"),a={type:"FeatureCollection",features:[]};let o,i={};for(let e=0;e<s.length&&(o=r(s[e]),"UNKNOWN"===o);e++);const l=p(s,o);return Object.values(l).forEach(((t,s)=>{if(t.message){const r=n(t.message);if(r){const o=[parseFloat(r[1]),parseFloat(r[0])];if(o[0]/Math.round(o[0])!=1&&o[1]/Math.round(o[1])!=0){i={type:"Feature",properties:{},geometry:{type:"Point",coordinates:o}};const r=e(l,s,n);r?(i.properties={...r},i.properties.related=r.id,l[r.id].mapped=!0):i.properties={username:t.username,time:t.time},i.properties.id=s,a.features.push(i),l[s].mapped=!0}}}})),{geoJSON:a,messages:l}}export{l as default,r as detectSystem,a as lookForMediaFile,p as parseAndIndex,o as parseMessage,i as parseTimeString,n as searchLocation};

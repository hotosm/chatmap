import{g as e}from"./chatmap-ChGbHgkD.js";import{searchLocation as t}from"./whatsapp-CmisqN8J.js";function o(e){return e.substring(e.lastIndexOf("/")+1,e.length)}const r=e=>new Date(e),i=e=>{let t=0;const i={};return e.forEach((e=>{const a=(e=>{let t="",i={time:r(e.date),username:e.from};return Array.isArray(e.text)?e.text.forEach((e=>{"link"===e.type&&(t=e.text)})):""!==e.text&&(t=e.text),i.message=t,e.location_information&&(i.location=[e.location_information.latitude,e.location_information.longitude]),e.photo&&(i.file=o(e.photo)),e.file&&"video/mp4"===e.mime_type&&(i.file=o(e.file)),i})(e);a&&(i[t]=a,i[t].id=t,t++)})),i};function a({text:o}){if(!o)return;const r=JSON.parse(o),a={type:"FeatureCollection",features:[]},n=i(r.messages);return Object.values(n).forEach(((o,r)=>{if(o.location){let i={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[o.location[1],o.location[0]]}};const s=e(n,r,t);s?(i.properties={...s},i.properties.related=s.id,n[s.id].mapped=!0):i.properties={username:o.username,time:o.time},i.properties.id=r,a.features.push(i),n[r].mapped=!0}})),{geoJSON:a,messages:n}}export{a as default};
